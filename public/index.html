<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Index</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script>
    const user = localStorage.getItem('user');
    if (!user) location.href = 'login.html';
  </script>

  <div class="container">
    <h2>Halo, <span id="currentUser"></span></h2>
    <input type="text" id="search" placeholder="Cari pengguna...">
    <ul id="userList"></ul>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    document.getElementById('currentUser').innerText = localStorage.getItem('user');

    async function loadUsers() {
      const res = await fetch('/users');
      const users = await res.json();
      const userList = document.getElementById('userList');
      userList.innerHTML = '';
      users.filter(u => u.username !== user).forEach(u => {
        const li = document.createElement('li');
        li.textContent = `${u.username} (${u.online ? 'Online' : 'Offline'})`;
        li.onclick = () => {
          localStorage.setItem('target', u.username);
          location.href = 'chat.html';
        };
        userList.appendChild(li);
      });
    }

    document.getElementById('search').addEventListener('input', loadUsers);
    loadUsers();

    function logout() {
      localStorage.removeItem('user');
      location.href = 'login.html';
    }
  </script>
</body>
</html>
