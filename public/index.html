<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat App</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="chat-wrapper">
    <div class="header">
      <button id="logoutBtn">Logout</button>
      <button id="toggleMode">Mode</button>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <div class="input-area">
      <input type="text" id="messageInput" placeholder="Ketik pesan...">
      <button id="sendBtn">Kirim</button>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>const socket = io();
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const chatBox = document.getElementById('chatBox');
const logoutBtn = document.getElementById('logoutBtn');
const toggleBtn = document.getElementById('toggleMode');

// Toggle dark mode
if (toggleBtn) {
  toggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    localStorage.setItem('mode', document.body.classList.contains('dark') ? 'dark' : '');
  });
}
if (localStorage.getItem('mode') === 'dark') {
  document.body.classList.add('dark');
}

sendBtn.addEventListener('click', () => {
  const text = messageInput.value;
  if (text.trim() !== '') {
    socket.emit('message', { text });
    messageInput.value = '';
  }
});

socket.on('message', msg => {
  const div = document.createElement('div');
  div.className = 'message';
  div.innerHTML = `<strong>${msg.user}</strong>: ${msg.text}`;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
});

logoutBtn.addEventListener('click', () => {
  socket.emit('logout');
  window.location.href = 'login.html';
});

socket.on('loginResult', data => {
  if (!data.success) {
    alert(data.message);
    window.location.href = 'login.html';
  } else {
    data.messages.forEach(msg => {
      const div = document.createElement('div');
      div.className = 'message';
      div.innerHTML = `<strong>${msg.user}</strong>: ${msg.text}`;
      chatBox.appendChild(div);
    });
  }
});</script>
</body>
</html>
