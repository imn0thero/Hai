<!DOCTYPE html>
<html>
<head>
  <title>Daftar Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>Selamat datang, <span id="me"></span></h2>
    <input type="text" id="search" placeholder="Cari username...">
    <ul id="userList"></ul>
    <button onclick="logout()">Logout</button>
  </div>
<script>
if (!localStorage.getItem('user')) location.href = 'login.html';

const me = localStorage.getItem('user');
document.getElementById('me').innerText = me;

function fetchUsers() {
  fetch('/users')
    .then(res => res.json())
    .then(users => {
      const list = document.getElementById('userList');
      list.innerHTML = '';
      const term = document.getElementById('search').value.toLowerCase();
      users.filter(u => u.username !== me && u.username.includes(term))
        .forEach(u => {
          const li = document.createElement('li');
          li.textContent = `${u.username} (${u.online ? 'Online' : 'Offline'})`;
          li.onclick = () => {
            localStorage.setItem('peer', u.username);
            window.location.href = 'chat.html';
          };
          list.appendChild(li);
        });
    });
}

document.getElementById('search').addEventListener('input', fetchUsers);
fetchUsers();
setInterval(fetchUsers, 5000);

function logout() {
  localStorage.removeItem('user');
  window.location.href = 'login.html';
}
</script>
</body>
</html>
